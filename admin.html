<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin ‚Ä¢ Pancho de Bag√©</title>
  <style>
    :root{--red:#b71c1c;--bg:#fff8f0;--card:#fff;--muted:#6b7280;--shadow:0 10px 25px rgba(0,0,0,.08);--r:16px}
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:#111}
    header{background:var(--red);color:#fff;padding:18px 14px;text-align:center}
    header h1{margin:0;font-size:20px}
    main{max-width:980px;margin:18px auto;padding:0 12px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    .card{background:var(--card);border-radius:var(--r);box-shadow:var(--shadow);padding:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:end}
    .field{flex:1;min-width:180px}
    label{display:block;font-size:12px;color:var(--muted);font-weight:800;margin-bottom:6px}
    input,select{width:100%;padding:12px;border:1px solid #e5e7eb;border-radius:12px;font-size:14px}
    button{border:0;border-radius:12px;padding:12px 14px;font-weight:900;cursor:pointer}
    .btnRed{background:var(--red);color:#fff}
    .btnGray{background:#111827;color:#fff}
    .btnLite{background:#f3f4f6}
    .muted{color:var(--muted);font-size:12px}
    .list{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:10px}
    .item{border:1px solid #eee;border-radius:14px;padding:12px}
    .item h3{margin:0 0 8px;font-size:16px}
    .pill{display:inline-flex;align-items:center;gap:8px;background:#f3f4f6;border-radius:999px;padding:6px 10px;font-weight:800;font-size:12px}
    .ok{background:#dcfce7}
    .bad{background:#fee2e2}
    .line{height:1px;background:#eee;margin:12px 0}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:640px){.two{grid-template-columns:1fr}}
    .hint{background:#fff;border-left:6px solid var(--red);border-radius:12px;padding:10px 12px;margin-bottom:12px}
    code{background:#f3f4f6;padding:2px 6px;border-radius:8px}
  </style>
</head>
<body>
<header>
  <h1>üîí Admin ‚Ä¢ Pancho de Bag√©</h1>
</header>

<main>
  <div class="hint">
    <div><b>Link do painel:</b> <span class="muted">seusite</span><code>/admin.html</code></div>
    <div class="muted">Tudo que voc√™ alterar aqui atualiza na hora para os clientes.</div>
  </div>

  <section class="grid">
    <div class="card" id="loginCard">
      <h2 style="margin:0 0 10px">Login</h2>
      <div class="row">
        <div class="field">
          <label>E-mail</label>
          <input id="email" placeholder="seuemail@gmail.com" />
        </div>
        <div class="field">
          <label>Senha</label>
          <input id="pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btnRed" id="btnLogin">Entrar</button>
        <button class="btnLite" id="btnLogout" style="display:none">Sair</button>
        <span class="pill bad" id="authState">Deslogado</span>
      </div>
      <div class="muted" id="authMsg" style="margin-top:8px"></div>
    </div>

    <div class="card" id="panelCard" style="display:none">
      <h2 style="margin:0 0 10px">Controle ao vivo</h2>

      <div class="row">
        <div class="field">
          <label>Status manual (openOverride)</label>
          <select id="openOverride">
            <option value="false">Usar hor√°rio normal</option>
            <option value="true">For√ßar ABERTO (teste)</option>
          </select>
          <div class="muted">Se colocar ‚ÄúFor√ßar ABERTO‚Äù, o site libera pedidos mesmo fora do hor√°rio.</div>
        </div>
        <div class="field">
          <button class="btnGray" id="btnSaveOverride" style="width:100%">Salvar status</button>
        </div>
      </div>

      <div class="line"></div>

      <h3 style="margin:0 0 8px">Hor√°rios (schedule)</h3>
      <div class="muted">Use 00:00 e 00:00 para ‚Äúfechado‚Äù. Dias: 0=Dom, 1=Seg, ... 6=S√°b.</div>

      <div class="two" id="scheduleGrid"></div>

      <div class="row" style="margin-top:10px">
        <button class="btnGray" id="btnSaveSchedule">Salvar hor√°rios</button>
      </div>

      <div class="line"></div>

      <h3 style="margin:0 0 8px">Estoque (stock)</h3>
      <div class="muted">Coloque 0 para ‚ÄúEsgotado‚Äù. 1~3 mostra ‚Äú√öltimas unidades‚Äù.</div>

      <div class="list" id="stockList"></div>

      <div class="row" style="margin-top:10px">
        <button class="btnRed" id="btnSaveStock">Salvar estoque</button>
      </div>

      <div class="muted" id="saveMsg" style="margin-top:10px"></div>
    </div>
  </section>
</main>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

<script>
  // ======= SEU FIREBASE CONFIG =======
  const firebaseConfig = {
    apiKey: "AIzaSyBYU_46dL6JAx2ijfmRntDh9mFlqSbsvD4",
    authDomain: "panchodebage.firebaseapp.com",
    projectId: "panchodebage",
    storageBucket: "panchodebage.firebasestorage.app",
    messagingSenderId: "555443410907",
    appId: "1:555443410907:web:76754b4bae7934cd58f9fe"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const DOC = db.collection("public").doc("menu");

  // Produtos (mesmos IDs do seu site)
  const PRODUCTS = [
    { id:"pancho_tradicional", nome:"Pancho Tradicional" },
    { id:"pancho_mega", nome:"Pancho Mega" },
    { id:"pancho_bacon_calabresa", nome:"Pancho Bacon e Calabresa" },
    { id:"pancho_coracao", nome:"Pancho Cora√ß√£o" },
    { id:"coca", nome:"Coca-Cola" },
    { id:"coca_zero", nome:"Coca-Cola Zero" },
    { id:"fruki", nome:"Fruki" },
    { id:"agua", nome:"√Ågua Mineral" },
  ];

  const el = (id)=>document.getElementById(id);

  const loginCard = el("loginCard");
  const panelCard = el("panelCard");
  const authState = el("authState");
  const authMsg = el("authMsg");
  const saveMsg = el("saveMsg");

  const email = el("email");
  const pass = el("pass");
  const btnLogin = el("btnLogin");
  const btnLogout = el("btnLogout");

  const openOverride = el("openOverride");
  const btnSaveOverride = el("btnSaveOverride");
  const scheduleGrid = el("scheduleGrid");
  const btnSaveSchedule = el("btnSaveSchedule");
  const stockList = el("stockList");
  const btnSaveStock = el("btnSaveStock");

  const dayNames = ["Domingo","Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado"];

  function buildScheduleUI(data){
    scheduleGrid.innerHTML = "";
    for(let d=0; d<=6; d++){
      const day = String(d);
      const abre = (data.schedule?.[day]?.abre ?? "19:00");
      const fecha = (data.schedule?.[day]?.fecha ?? "23:30");

      const box = document.createElement("div");
      box.className = "card";
      box.style.boxShadow = "none";
      box.style.border = "1px solid #eee";
      box.innerHTML = `
        <b>${dayNames[d]} ( ${d} )</b>
        <div class="two" style="margin-top:10px">
          <div class="field">
            <label>Abre</label>
            <input data-day="${day}" data-k="abre" value="${abre}" placeholder="19:00" />
          </div>
          <div class="field">
            <label>Fecha</label>
            <input data-day="${day}" data-k="fecha" value="${fecha}" placeholder="23:30" />
          </div>
        </div>
        <div class="muted" style="margin-top:8px">Use 00:00 e 00:00 para fechado.</div>
      `;
      scheduleGrid.appendChild(box);
    }
  }

  function buildStockUI(data){
    stockList.innerHTML = "";
    PRODUCTS.forEach(p=>{
      const v = Number(data.stock?.[p.id] ?? 0);
      const item = document.createElement("div");
      item.className = "item";
      item.innerHTML = `
        <h3>${p.nome}</h3>
        <div class="row">
          <div class="field">
            <label>Quantidade</label>
            <input type="number" min="0" step="1" data-stock="${p.id}" value="${v}" />
          </div>
          <span class="pill ${v>0 ? "ok":"bad"}">${v>0 ? "Dispon√≠vel":"Esgotado"}</span>
        </div>
      `;
      stockList.appendChild(item);
    });
  }

  async function loadDoc(){
    const snap = await DOC.get();
    const data = snap.data() || {};
    openOverride.value = String(!!data.openOverride);
    buildScheduleUI(data);
    buildStockUI(data);
  }

  btnLogin.addEventListener("click", async ()=>{
    authMsg.textContent = "";
    try{
      await auth.signInWithEmailAndPassword(email.value.trim(), pass.value);
    }catch(e){
      authMsg.textContent = "Erro no login: " + e.message;
    }
  });

  btnLogout.addEventListener("click", async ()=>{
    await auth.signOut();
  });

  btnSaveOverride.addEventListener("click", async ()=>{
    saveMsg.textContent = "";
    try{
      await DOC.set({ openOverride: openOverride.value === "true" }, { merge:true });
      saveMsg.textContent = "‚úÖ Status salvo e atualizado na hora.";
    }catch(e){
      saveMsg.textContent = "‚ùå Erro ao salvar: " + e.message;
    }
  });

  btnSaveSchedule.addEventListener("click", async ()=>{
    saveMsg.textContent = "";
    try{
      const inputs = Array.from(document.querySelectorAll("[data-day][data-k]"));
      const schedule = {};
      inputs.forEach(i=>{
        const d = i.getAttribute("data-day");
        const k = i.getAttribute("data-k");
        schedule[d] = schedule[d] || {};
        schedule[d][k] = (i.value || "").trim();
      });
      await DOC.set({ schedule }, { merge:true });
      saveMsg.textContent = "‚úÖ Hor√°rios salvos e atualizados na hora.";
    }catch(e){
      saveMsg.textContent = "‚ùå Erro ao salvar: " + e.message;
    }
  });

  btnSaveStock.addEventListener("click", async ()=>{
    saveMsg.textContent = "";
    try{
      const inputs = Array.from(document.querySelectorAll("[data-stock]"));
      const stock = {};
      inputs.forEach(i=>{
        const id = i.getAttribute("data-stock");
        stock[id] = Math.max(0, parseInt(i.value || "0", 10) || 0);
      });
      await DOC.set({ stock }, { merge:true });
      saveMsg.textContent = "‚úÖ Estoque salvo e atualizado na hora.";
    }catch(e){
      saveMsg.textContent = "‚ùå Erro ao salvar: " + e.message;
    }
  });

  auth.onAuthStateChanged(async (user)=>{
    if(user){
      authState.textContent = "Logado";
      authState.className = "pill ok";
      btnLogout.style.display = "inline-block";
      panelCard.style.display = "block";
      await loadDoc();
      DOC.onSnapshot(()=>loadDoc());
    }else{
      authState.textContent = "Deslogado";
      authState.className = "pill bad";
      btnLogout.style.display = "none";
      panelCard.style.display = "none";
    }
  });
</script>
</body>
</html>
