<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pancho de Bag√©</title>
  <style>
    :root{
      --red:#b71c1c;
      --green:#2e7d32;
      --bg:#fff8f0;
      --card:#ffffff;
      --muted:#6b7280;
      --shadow:0 10px 25px rgba(0,0,0,.08);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:#111}
    .top{
      background:var(--red);
      color:#fff;
      padding:28px 16px 22px;
      text-align:center;
      position:sticky; top:0; z-index:5;
    }
    .brand{display:flex;gap:10px;justify-content:center;align-items:center}
    .brand h1{margin:0;font-size:28px;line-height:1.1}
    .subtitle{margin:8px 0 0;opacity:.92}
    .statusRow{margin-top:14px;display:flex;flex-direction:column;gap:8px;align-items:center}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.25);
      padding:8px 12px;border-radius:999px;
      font-weight:700;
    }
    .dot{width:10px;height:10px;border-radius:999px;background:#ff5252}
    .dot.on{background:#34d399}
    .hours{font-size:13px;opacity:.95}

    .notice{
      margin:14px auto 0;
      max-width:1100px;
      background:#fff;
      border-left:6px solid var(--red);
      border-radius:12px;
      padding:12px 14px;
      box-shadow:0 6px 18px rgba(0,0,0,.05);
      width:calc(100% - 24px);
    }
    .notice strong{color:#111}
    .wrap{max-width:1100px;margin:18px auto 90px;padding:0 12px}

    h2{margin:26px 6px 12px;font-size:22px}
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:14px;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:150px;
    }
    .card h3{margin:0;font-size:18px}
    .desc{margin:0;color:var(--muted);font-size:13px;line-height:1.3}
    .price{font-weight:800;color:var(--green)}
    .badges{display:flex;gap:8px;flex-wrap:wrap}
    .badge{
      font-size:12px;
      padding:4px 10px;
      border-radius:999px;
      background:#f3f4f6;
      color:#111;
      border:1px solid #e5e7eb;
    }
    .badge.warn{background:#fff7ed;border-color:#fed7aa;color:#9a3412}
    .badge.out{background:#fee2e2;border-color:#fecaca;color:#991b1b}
    .btn{
      border:0;
      border-radius:12px;
      padding:12px 12px;
      font-weight:800;
      cursor:pointer;
      background:var(--red);
      color:#fff;
      transition:transform .04s ease,opacity .2s ease;
      margin-top:auto;
    }
    .btn:active{transform:scale(.99)}
    .btn[disabled]{opacity:.45;cursor:not-allowed}

    .map{
      margin-top:20px;
      background:#fff;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .mapHead{padding:14px 14px 8px}
    iframe{width:100%;height:260px;border:0}

    /* Floating Cart Button */
    .cartFab{
      position:fixed;right:14px;bottom:14px;z-index:10;
      border:0;border-radius:999px;
      padding:12px 16px;
      background:var(--green);color:#fff;
      font-weight:900;
      box-shadow:0 14px 28px rgba(0,0,0,.18);
      cursor:pointer;
      display:flex;gap:10px;align-items:center;
    }
    .cartCount{
      background:rgba(255,255,255,.2);
      padding:2px 9px;border-radius:999px;
      font-weight:900;
    }
    .cartFab[disabled]{opacity:.55;cursor:not-allowed}

    /* Drawer */
    .overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.42);
      display:none;z-index:20;
    }
    .drawer{
      position:fixed;right:0;top:0;height:100%;width:min(420px,100%);
      background:#fff;z-index:21;
      transform:translateX(100%);
      transition:transform .2s ease;
      display:flex;flex-direction:column;
    }
    .drawer.open{transform:translateX(0)}
    .overlay.show{display:block}
    .drawerHead{
      padding:14px 14px 10px;
      border-bottom:1px solid #eee;
      display:flex;align-items:center;justify-content:space-between;
      gap:10px;
    }
    .drawerHead h3{margin:0}
    .xbtn{
      border:0;background:#f3f4f6;border-radius:12px;
      padding:10px 12px;font-weight:900;cursor:pointer;
    }
    .drawerBody{padding:12px 14px;overflow:auto;flex:1}
    .row{
      display:flex;align-items:center;justify-content:space-between;
      gap:10px;padding:10px 0;border-bottom:1px dashed #eee;
    }
    .row:last-child{border-bottom:0}
    .rowTitle{font-weight:800}
    .rowSub{font-size:12px;color:var(--muted)}
    .qty{
      display:flex;align-items:center;gap:8px;
    }
    .qbtn{
      width:34px;height:34px;border-radius:10px;border:1px solid #e5e7eb;
      background:#fff;font-weight:900;cursor:pointer;
    }
    .qnum{min-width:22px;text-align:center;font-weight:900}
    .sumLine{display:flex;justify-content:space-between;margin-top:12px;font-weight:900}
    .small{font-size:12px;color:var(--muted);margin:6px 0 0}

    .form{
      margin-top:14px;
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
    }
    .field label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px;font-weight:800}
    .field input,.field select,.field textarea{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid #e5e7eb;
      outline:none;
      font-size:14px;
    }
    textarea{min-height:80px;resize:vertical}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:520px){ .two{grid-template-columns:1fr} }

    .drawerFoot{
      padding:12px 14px;
      border-top:1px solid #eee;
      background:#fff;
    }
    .cta{
      width:100%;
      border:0;border-radius:14px;
      padding:14px 14px;
      font-weight:900;
      background:var(--green);
      color:#fff;
      cursor:pointer;
    }
    .cta[disabled]{opacity:.55;cursor:not-allowed}
  </style>
</head>
<body>

  <header class="top" id="top">
    <div class="brand">
      <div style="font-size:26px">üå≠</div>
      <h1>Pancho de Bag√©</h1>
    </div>
    <p class="subtitle">Pre√ßo, sabor e qualidade</p>

    <div class="statusRow">
      <div class="pill">
        <span class="dot" id="dot"></span>
        <span id="statusText">Carregando...</span>
      </div>
      <div class="hours" id="hoursText">Hor√°rio de pedidos: carregando...</div>
    </div>
  </header>

  <div class="notice" id="notice" style="display:none;">
    <strong id="noticeTitle">Aviso</strong>
    <span id="noticeMsg"></span>
  </div>

  <main class="wrap">
    <h2>Panchos</h2>
    <div class="grid" id="gridPanchos"></div>

    <h2>Bebidas</h2>
    <div class="grid" id="gridBebidas"></div>

    <section class="map">
      <div class="mapHead">
        <h2 style="margin:0 0 6px">üìç Nossa localiza√ß√£o</h2>
        <div class="small">Retirada e entrega</div>
      </div>
      <!-- Seu iframe do Google Maps (o mesmo que voc√™ mandou) -->
      <iframe
        src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d211.0479914127845!2d-52.15849772790478!3d-32.183534001143!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1spt-BR!2sbr!4v1768363410929!5m2!1spt-BR!2sbr"
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade">
      </iframe>
    </section>
  </main>

  <button class="cartFab" id="cartFab">
    üõí Carrinho <span class="cartCount" id="cartCount">0</span>
  </button>

  <div class="overlay" id="overlay"></div>
  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="drawerHead">
      <h3>Seu carrinho</h3>
      <button class="xbtn" id="closeDrawer">Fechar ‚úï</button>
    </div>

    <div class="drawerBody">
      <div id="cartList"></div>

      <div class="sumLine">
        <div>Total</div>
        <div id="totalText">R$ 0,00</div>
      </div>
      <div class="small">Pagamento e endere√ßo ser√£o informados no WhatsApp.</div>

      <div class="form">
        <div class="field">
          <label>Nome do destinat√°rio</label>
          <input id="fNome" placeholder="Ex: Jo√£o" />
        </div>

        <div class="two">
          <div class="field">
            <label>Entrega ou retirada?</label>
            <select id="fTipo">
              <option value="retirada">Retirada</option>
              <option value="entrega">Entrega</option>
            </select>
          </div>

          <div class="field">
            <label>Forma de pagamento</label>
            <select id="fPagto">
              <option value="dinheiro">Dinheiro</option>
              <option value="pix">PIX</option>
              <option value="cartao">Cart√£o</option>
            </select>
          </div>
        </div>

        <div class="field" id="boxEndereco" style="display:none;">
          <label>Endere√ßo (somente para entrega)</label>
          <input id="fEndereco" placeholder="Rua, n√∫mero, bairro, complemento" />
        </div>

        <div class="two">
          <div class="field">
            <label>Hor√°rio do pedido (opcional)</label>
            <input id="fHorario" placeholder="Ex: 20:15" />
          </div>
          <div class="field">
            <label>Telefone do cliente (opcional)</label>
            <input id="fTel" placeholder="Ex: (53) 99999-9999" />
          </div>
        </div>

        <div class="field">
          <label>Observa√ß√µes do lanche</label>
          <textarea id="fObs" placeholder="Ex: prensado, sem maionese, sem cebola..."></textarea>
        </div>
      </div>
    </div>

    <div class="drawerFoot">
      <button class="cta" id="btnWhats">Finalizar pedido no WhatsApp</button>
      <div class="small" id="blockMsg" style="margin-top:8px;display:none;"></div>
    </div>
  </aside>

  <!-- Firebase (Compat - funciona no GitHub Pages) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

  <script>
    // ========= CONFIG FIREBASE (SEU PROJETO) =========
    const firebaseConfig = {
      apiKey: "AIzaSyBYU_46dL6JAx2ijfmRntDh9mFlqSbsvD4",
      authDomain: "panchodebage.firebaseapp.com",
      projectId: "panchodebage",
      storageBucket: "panchodebage.firebasestorage.app",
      messagingSenderId: "555443410907",
      appId: "1:555443410907:web:76754b4bae7934cd58f9fe"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ========= DADOS DO SEU NEG√ìCIO =========
    const WHATSAPP_NUMBER = "5553999021357"; // seu n√∫mero
    const DOC_PATH = db.collection("public").doc("menu");

    // Produtos (IDs batem com o stock do Firestore)
    const PRODUCTS = [
      { id:"pancho_tradicional", nome:"Pancho Tradicional", preco:18.00, categoria:"panchos",
        desc:"P√£o, condimentos, salsicha defumada e queijo mussarela" },
      { id:"pancho_mega", nome:"Pancho Mega", preco:20.00, categoria:"panchos",
        desc:"P√£o, condimentos, salsicha (extra) e queijo (extra)" },
      { id:"pancho_bacon_calabresa", nome:"Pancho Bacon e Calabresa", preco:22.00, categoria:"panchos",
        desc:"P√£o, condimentos, bacon/calabresa e queijo mussarela" },
      { id:"pancho_coracao", nome:"Pancho Cora√ß√£o", preco:24.00, categoria:"panchos",
        desc:"P√£o, condimentos, cora√ß√£o e queijo mussarela" },

      { id:"coca", nome:"Coca-Cola", preco:6.00, categoria:"bebidas", desc:"Lata/Unidade" },
      { id:"coca_zero", nome:"Coca-Cola Zero", preco:6.00, categoria:"bebidas", desc:"Lata/Unidade" },
      { id:"fruki", nome:"Fruki", preco:6.00, categoria:"bebidas", desc:"Lata/Unidade" },
      { id:"agua", nome:"√Ågua Mineral", preco:4.00, categoria:"bebidas", desc:"Unidade" },
    ];

    // ========= ESTADO =========
    const state = {
      stock: {},         // vem do Firestore
      schedule: {},      // vem do Firestore
      openOverride: false,
      isOpen: false,
      cart: {}           // { id: qty }
    };

    // ========= UTIL =========
    const money = (v) => v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

    function dayIndexLocal(){
      return new Date().getDay(); // 0=domingo
    }

    function parseHHMM(s){
      if(!s || typeof s !== "string") return null;
      const m = s.trim().match(/^(\d{1,2}):(\d{2})$/);
      if(!m) return null;
      const hh = Math.min(23, Math.max(0, parseInt(m[1],10)));
      const mm = Math.min(59, Math.max(0, parseInt(m[2],10)));
      return hh*60 + mm;
    }

    function computeIsOpen(){
      if(state.openOverride === true) return true;

      const idx = dayIndexLocal();
      const today = state.schedule?.[String(idx)] || state.schedule?.[idx] || null;
      const abre = parseHHMM(today?.abre);
      const fecha = parseHHMM(today?.fecha);

      // Se n√£o tem hor√°rio ou √© 00:00-00:00 => fechado
      if(abre === null || fecha === null) return false;
      if(abre === 0 && fecha === 0) return false;

      const now = new Date();
      const nowMin = now.getHours()*60 + now.getMinutes();

      // Se fecha <= abre, considera que fecha no dia seguinte (ex: 19:00 -> 00:00)
      if(fecha <= abre){
        return (nowMin >= abre) || (nowMin < fecha);
      }
      return (nowMin >= abre) && (nowMin < fecha);
    }

    function todayHoursLabel(){
      const idx = dayIndexLocal();
      const today = state.schedule?.[String(idx)] || state.schedule?.[idx] || null;
      const a = today?.abre || "--:--";
      const f = today?.fecha || "--:--";
      return `Hor√°rio de pedidos hoje: ${a} √†s ${f}`;
    }

    // ========= UI refs =========
    const gridPanchos = document.getElementById("gridPanchos");
    const gridBebidas = document.getElementById("gridBebidas");
    const cartFab = document.getElementById("cartFab");
    const cartCount = document.getElementById("cartCount");
    const overlay = document.getElementById("overlay");
    const drawer = document.getElementById("drawer");
    const closeDrawerBtn = document.getElementById("closeDrawer");
    const cartList = document.getElementById("cartList");
    const totalText = document.getElementById("totalText");
    const btnWhats = document.getElementById("btnWhats");

    const statusText = document.getElementById("statusText");
    const dot = document.getElementById("dot");
    const hoursText = document.getElementById("hoursText");

    const notice = document.getElementById("notice");
    const noticeTitle = document.getElementById("noticeTitle");
    const noticeMsg = document.getElementById("noticeMsg");

    const fNome = document.getElementById("fNome");
    const fTipo = document.getElementById("fTipo");
    const fPagto = document.getElementById("fPagto");
    const fEndereco = document.getElementById("fEndereco");
    const fHorario = document.getElementById("fHorario");
    const fTel = document.getElementById("fTel");
    const fObs = document.getElementById("fObs");
    const boxEndereco = document.getElementById("boxEndereco");
    const blockMsg = document.getElementById("blockMsg");

    // ========= RENDER =========
    function renderProducts(){
      const panchos = PRODUCTS.filter(p => p.categoria === "panchos");
      const bebidas = PRODUCTS.filter(p => p.categoria === "bebidas");

      gridPanchos.innerHTML = panchos.map(cardHTML).join("");
      gridBebidas.innerHTML = bebidas.map(cardHTML).join("");

      // bind buttons
      document.querySelectorAll("[data-add]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-add");
          addToCart(id);
        });
      });

      updateButtons();
    }

    function cardHTML(p){
      return `
        <div class="card" id="card_${p.id}">
          <div>
            <h3>${p.nome}</h3>
            ${p.desc ? `<p class="desc">${p.desc}</p>` : ``}
          </div>
          <div class="price">${money(p.preco)}</div>
          <div class="badges" id="badges_${p.id}"></div>
          <button class="btn" data-add="${p.id}" id="btn_${p.id}">Adicionar</button>
        </div>
      `;
    }

    function updateButtons(){
      // aberto/fechado
      state.isOpen = computeIsOpen();

      dot.classList.toggle("on", state.isOpen);
      statusText.textContent = state.isOpen ? "Aberto" : "Fechado";
      hoursText.textContent = todayHoursLabel();

      if(!state.isOpen){
        showNotice("Estamos fechados no momento.", "Fora do hor√°rio, n√£o √© poss√≠vel adicionar itens nem finalizar pedidos.");
      } else {
        hideNotice();
      }

      // habilita/desabilita bot√µes
      PRODUCTS.forEach(p=>{
        const stock = Number(state.stock?.[p.id] ?? 0);
        const btn = document.getElementById(`btn_${p.id}`);
        const badges = document.getElementById(`badges_${p.id}`);
        if(!btn || !badges) return;

        badges.innerHTML = "";

        if(stock <= 0){
          badges.innerHTML += `<span class="badge out">Esgotado</span>`;
        } else if(stock > 0 && stock <= 3){
          badges.innerHTML += `<span class="badge warn">√öltimas unidades</span>`;
        }

        if(!state.isOpen || stock <= 0){
          btn.disabled = true;
        } else {
          btn.disabled = false;
        }
      });

      // bot√£o carrinho
      cartFab.disabled = !state.isOpen;
      btnWhats.disabled = !state.isOpen;

      if(!state.isOpen){
        blockMsg.style.display = "block";
        blockMsg.textContent = "Fora do hor√°rio n√£o √© poss√≠vel finalizar pedidos.";
      } else {
        blockMsg.style.display = "none";
        blockMsg.textContent = "";
      }
    }

    function showNotice(title, msg){
      notice.style.display = "block";
      noticeTitle.textContent = title;
      noticeMsg.textContent = " " + msg;
    }
    function hideNotice(){
      notice.style.display = "none";
    }

    function renderCart(){
      const entries = Object.entries(state.cart).filter(([_,q])=>q>0);

      cartCount.textContent = String(entries.reduce((a,[_,q])=>a+q,0));

      if(entries.length === 0){
        cartList.innerHTML = `<div class="small">Seu carrinho est√° vazio.</div>`;
        totalText.textContent = money(0);
        return;
      }

      let total = 0;

      cartList.innerHTML = entries.map(([id, qty])=>{
        const p = PRODUCTS.find(x=>x.id===id);
        if(!p) return "";
        const line = p.preco * qty;
        total += line;
        return `
          <div class="row">
            <div>
              <div class="rowTitle">${p.nome}</div>
              <div class="rowSub">${money(p.preco)} ‚Ä¢ Subtotal ${money(line)}</div>
            </div>
            <div class="qty">
              <button class="qbtn" data-dec="${id}">‚àí</button>
              <div class="qnum">${qty}</div>
              <button class="qbtn" data-inc="${id}">+</button>
            </div>
          </div>
        `;
      }).join("");

      totalText.textContent = money(total);

      // binds
      cartList.querySelectorAll("[data-inc]").forEach(b=>{
        b.addEventListener("click", ()=>inc(b.getAttribute("data-inc")));
      });
      cartList.querySelectorAll("[data-dec]").forEach(b=>{
        b.addEventListener("click", ()=>dec(b.getAttribute("data-dec")));
      });
    }

    // ========= CART ACTIONS =========
    function addToCart(id){
      if(!state.isOpen) return;

      const stock = Number(state.stock?.[id] ?? 0);
      const current = Number(state.cart?.[id] ?? 0);

      if(stock <= 0) return;
      if(current + 1 > stock){
        alert("Sem estoque suficiente para adicionar mais desse item.");
        return;
      }

      state.cart[id] = current + 1;
      renderCart();
    }

    function inc(id){
      addToCart(id);
    }
    function dec(id){
      const current = Number(state.cart?.[id] ?? 0);
      if(current <= 1) delete state.cart[id];
      else state.cart[id] = current - 1;
      renderCart();
    }

    function openDrawer(){
      overlay.classList.add("show");
      drawer.classList.add("open");
      drawer.setAttribute("aria-hidden","false");
      renderCart();
    }
    function closeDrawer(){
      overlay.classList.remove("show");
      drawer.classList.remove("open");
      drawer.setAttribute("aria-hidden","true");
    }

    // ========= ORDER / WHATSAPP =========
    function buildOrderText(){
      const entries = Object.entries(state.cart).filter(([_,q])=>q>0);
      if(entries.length === 0) return { ok:false, msg:"Carrinho vazio." };

      const nome = (fNome.value || "").trim();
      const tipo = fTipo.value; // retirada/entrega
      const pagto = fPagto.value;
      const endereco = (fEndereco.value || "").trim();
      const horario = (fHorario.value || "").trim();
      const tel = (fTel.value || "").trim();
      const obs = (fObs.value || "").trim();

      if(!nome) return { ok:false, msg:"Informe o nome do destinat√°rio." };
      if(tipo === "entrega" && !endereco) return { ok:false, msg:"Informe o endere√ßo para entrega." };

      let total = 0;
      let lines = [];

      entries.forEach(([id, qty], i)=>{
        const p = PRODUCTS.find(x=>x.id===id);
        if(!p) return;
        const sub = p.preco * qty;
        total += sub;
        lines.push(`${i+1}) ${p.nome} x${qty} ‚Äî ${money(sub)}`);
      });

      const parts = [];
      parts.push(`Ol√°! Quero fazer um pedido no *Pancho de Bag√©* üçîüå≠`);
      parts.push("");
      parts.push(`*Nome:* ${nome}`);
      if(tel) parts.push(`*Telefone:* ${tel}`);
      if(horario) parts.push(`*Hor√°rio desejado:* ${horario}`);
      parts.push(`*Tipo:* ${tipo === "entrega" ? "Entrega" : "Retirada"}`);
      if(tipo === "entrega") parts.push(`*Endere√ßo:* ${endereco}`);
      parts.push(`*Pagamento:* ${pagto.toUpperCase()}`);
      if(obs) parts.push(`*Observa√ß√µes:* ${obs}`);
      parts.push("");
      parts.push("*Itens:*");
      parts.push(...lines);
      parts.push("");
      parts.push(`*Total:* ${money(total)}`);

      return { ok:true, text: parts.join("\n") };
    }

    function sendWhats(){
      if(!state.isOpen){
        alert("Fora do hor√°rio, n√£o √© poss√≠vel finalizar.");
        return;
      }

      const res = buildOrderText();
      if(!res.ok){
        alert(res.msg);
        return;
      }

      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(res.text)}`;
      window.open(url, "_blank");
    }

    // ========= FORM UI =========
    fTipo.addEventListener("change", ()=>{
      boxEndereco.style.display = (fTipo.value === "entrega") ? "block" : "none";
    });

    // ========= EVENTS =========
    cartFab.addEventListener("click", openDrawer);
    overlay.addEventListener("click", closeDrawer);
    closeDrawerBtn.addEventListener("click", closeDrawer);
    btnWhats.addEventListener("click", sendWhats);

    // ========= FIRESTORE REALTIME =========
    function startRealtime(){
      // Atualiza UI pelo rel√≥gio tamb√©m (caso vire o minuto/dia)
      setInterval(()=>updateButtons(), 15000);

      DOC_PATH.onSnapshot((snap)=>{
        const data = snap.data() || {};
        state.stock = data.stock || {};
        state.schedule = data.schedule || {};
        state.openOverride = !!data.openOverride;

        // Ajusta carrinho se passou do estoque
        Object.keys(state.cart).forEach(id=>{
          const st = Number(state.stock?.[id] ?? 0);
          if(st <= 0) delete state.cart[id];
          else if(state.cart[id] > st) state.cart[id] = st;
        });

        updateButtons();
        renderCart();
      }, (err)=>{
        console.error("Erro Firestore:", err);
        showNotice("Erro ao carregar dados.", "Confira as regras do Firestore e a conex√£o.");
      });
    }

    // ========= INIT =========
    renderProducts();
    renderCart();
    startRealtime();
  </script>

</body>
</html>
