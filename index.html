<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pancho de Bag√©</title>

<style>
* { box-sizing: border-box; }
body { margin: 0; font-family: Arial, sans-serif; background: #fff8f0; }
header { background: #b71c1c; color: white; padding: 22px; text-align: center; }
section { padding: 20px; max-width: 1100px; margin: auto; }
h2 { margin-top: 30px; }

.grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 15px; }
.item { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 3px 8px rgba(0,0,0,.1); }
.price { font-weight: bold; color: #2e7d32; }

.item button {
  margin-top: 10px; width: 100%; padding: 10px;
  background: #b71c1c; color: white; border: none; border-radius: 6px; cursor: pointer;
}
.item button:disabled { background: #9e9e9e; cursor: not-allowed; }

.badge {
  display: inline-block; padding: 6px 10px; border-radius: 999px;
  font-size: 12px; font-weight: bold; margin-top: 8px;
}
.badge.ok { background: #e8f5e9; color: #1b5e20; }
.badge.closed { background: #ffebee; color: #b71c1c; }
.badge.soldout { background: #eeeeee; color: #424242; }
.badge.low { background: #fff3e0; color: #e65100; }

.notice {
  margin: 12px auto 0; max-width: 1100px;
  padding: 12px 14px; border-radius: 10px; background: #fff;
  box-shadow: 0 3px 8px rgba(0,0,0,.08);
  border-left: 6px solid #b71c1c;
}

.cart-btn {
  position: fixed; bottom: 20px; right: 20px;
  background: #2e7d32; color: white;
  padding: 15px 18px; border-radius: 50px; border: none;
  cursor: pointer; z-index: 1000;
}
.cart-btn:disabled { background: #9e9e9e; cursor: not-allowed; }

.cart {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: white; padding: 20px;
  border-radius: 20px 20px 0 0;
  box-shadow: 0 -4px 15px rgba(0,0,0,.3);
  display: none; max-height: 82vh; overflow-y: auto; z-index: 1001;
}
.cart h3 { margin: 10px 0; }
.cart-item { display: flex; justify-content: space-between; margin-bottom: 10px; gap: 10px; }
.cart-controls button { padding: 4px 8px; margin-left: 4px; }
.total { font-weight: bold; margin-top: 10px; }

.finalizar {
  width: 100%; background: #2e7d32; padding: 14px; border: none;
  border-radius: 8px; margin-top: 10px; color: white; cursor: pointer;
}
.finalizar:disabled { background: #9e9e9e; cursor: not-allowed; }

.form-grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 10px; }
.form-grid.two { grid-template-columns: 1fr; }
label { font-size: 14px; font-weight: bold; }
input, select, textarea {
  width: 100%; padding: 10px; border: 1px solid #ddd;
  border-radius: 8px; font-size: 14px;
}
textarea { min-height: 90px; resize: vertical; }
.helper { font-size: 12px; color: #555; margin-top: -6px; }
.hidden { display: none; }

@media (min-width: 700px) { .form-grid.two { grid-template-columns: 1fr 1fr; } }

/* ===== Painel Admin ===== */
.admin-overlay{
  position: fixed; inset: 0; background: rgba(0,0,0,.45);
  display:none; align-items: flex-end; justify-content: center; z-index: 2000;
}
.admin-panel{
  width: min(900px, 100%);
  background: #fff; border-radius: 18px 18px 0 0;
  padding: 16px; max-height: 85vh; overflow: auto;
}
.admin-top{
  display:flex; justify-content: space-between; align-items:center; gap:10px;
}
.admin-top h3{ margin: 8px 0; }
.admin-row{
  display:grid; grid-template-columns: 1.2fr .7fr .7fr; gap:10px;
  padding: 10px 0; border-bottom: 1px solid #eee; align-items:center;
}
.admin-row small{ color:#666; }
.admin-actions{ display:flex; gap:10px; }
.admin-actions button{
  border:none; border-radius:10px; padding:10px 12px; cursor:pointer;
}
.btn-save{ background:#2e7d32; color:#fff; }
.btn-close{ background:#b71c1c; color:#fff; }
.btn-reset{ background:#9e9e9e; color:#fff; }
</style>
</head>

<body>

<header id="hdr">
  <h1>üå≠ Pancho de Bag√©</h1>
  <p>Pre√ßo, sabor e qualidade</p>
  <div id="status-badge" class="badge ok">üü¢ Aberto</div>
  <div style="font-size:12px;opacity:.9;margin-top:6px" id="hours-text"></div>
  <div style="font-size:11px;opacity:.75;margin-top:6px">
  </div>
</header>

<div class="notice" id="notice" style="display:none;"></div>

<section>
  <h2>Panchos</h2>
  <div class="grid">
    <div class="item">
      <h3>Pancho Tradicional</h3>
      <p class="price">R$ 18,00</p>
      <div id="tag-pancho_tradicional"></div>
      <button id="btn-pancho_tradicional" onclick="addItem('Pancho Tradicional',18,'pancho_tradicional')">Adicionar</button>
    </div>

    <div class="item">
      <h3>Pancho Mega</h3>
      <p class="price">R$ 20,00</p>
      <div id="tag-pancho_mega"></div>
      <button id="btn-pancho_mega" onclick="addItem('Pancho Mega',20,'pancho_mega')">Adicionar</button>
    </div>

    <div class="item">
      <h3>Pancho Bacon e Calabresa</h3>
      <p class="price">R$ 22,00</p>
      <div id="tag-pancho_bacon_calabresa"></div>
      <button id="btn-pancho_bacon_calabresa" onclick="addItem('Pancho Bacon e Calabresa',22,'pancho_bacon_calabresa')">Adicionar</button>
    </div>

    <div class="item">
      <h3>Pancho Cora√ß√£o</h3>
      <p class="price">R$ 24,00</p>
      <div id="tag-pancho_coracao"></div>
      <button id="btn-pancho_coracao" onclick="addItem('Pancho Cora√ß√£o',24,'pancho_coracao')">Adicionar</button>
    </div>
  </div>

  <h2>Bebidas</h2>
  <div class="grid">
    <div class="item">
      <h3>Coca-Cola</h3>
      <p class="price">R$ 6,00</p>
      <div id="tag-coca"></div>
      <button id="btn-coca" onclick="addItem('Coca-Cola',6,'coca')">Adicionar</button>
    </div>

    <div class="item">
      <h3>Coca-Cola Zero</h3>
      <p class="price">R$ 6,00</p>
      <div id="tag-coca_zero"></div>
      <button id="btn-coca_zero" onclick="addItem('Coca-Cola Zero',6,'coca_zero')">Adicionar</button>
    </div>

    <div class="item">
      <h3>Fruki</h3>
      <p class="price">R$ 6,00</p>
      <div id="tag-fruki"></div>
      <button id="btn-fruki" onclick="addItem('Fruki',5,'fruki')">Adicionar</button>
    </div>

    <div class="item">
      <h3>√Ågua Mineral</h3>
      <p class="price">R$ 4,00</p>
      <div id="tag-agua"></div>
      <button id="btn-agua" onclick="addItem('√Ågua Mineral',4,'agua')">Adicionar</button>
    </div>
  </div>
</section>

<button id="cartBtn" class="cart-btn" onclick="openCart()">üõí Carrinho</button>

<div class="cart" id="cart">
  <button onclick="closeCart()">‚ùå Fechar</button>

  <h3>üßæ Seus itens</h3>
  <div id="cart-items">üõí Carrinho vazio</div>
  <div class="total" id="total">Total: R$ 0,00</div>

  <h3>üìã Dados do pedido</h3>

  <div class="form-grid two">
    <div>
      <label for="nome">Nome do destinat√°rio *</label>
      <input id="nome" type="text" placeholder="Ex: Jo√£o Silva">
    </div>

    <div>
      <label for="horario">Hor√°rio do pedido *</label>
      <select id="horario">
        <option value="">Selecione</option>
        <option>Agora</option>
        <option>Daqui 15 min</option>
        <option>Daqui 30 min</option>
        <option>Daqui 45 min</option>
        <option>Daqui 60 min</option>
      </select>
      <div class="helper">Se preferir, escolha ‚ÄúAgora‚Äù.</div>
    </div>
  </div>

  <div class="form-grid two">
    <div>
      <label for="tipo">Entrega ou retirada *</label>
      <select id="tipo" onchange="toggleEntrega()">
        <option value="">Selecione</option>
        <option value="Retirada">Retirada</option>
        <option value="Entrega">Entrega</option>
      </select>
    </div>

    <div>
      <label for="pagamento">Forma de pagamento *</label>
      <select id="pagamento">
        <option value="">Selecione</option>
        <option>Pix</option>
        <option>Dinheiro</option>
        <option>Cart√£o</option>
      </select>
      <div class="helper">Para entrega, informe a forma de pagamento.</div>
    </div>
  </div>

  <div id="entrega-box" class="hidden">
    <label for="endereco">Endere√ßo para entrega *</label>
    <input id="endereco" type="text" placeholder="Rua, n√∫mero, bairro, refer√™ncia...">
    <div class="helper">Ex: Rua X, 123, Centro. Perto do mercado Y.</div>
  </div>

  <div class="form-grid">
    <label for="obs">Observa√ß√µes do lanche</label>
    <textarea id="obs" placeholder="Ex: Prensado, sem maionese, sem ketchup, bem recheado..."></textarea>
  </div>

  <button id="finalizarBtn" class="finalizar" onclick="sendOrder()">Finalizar pedido pelo WhatsApp</button>
</div>

<!-- ====== Painel Admin escondido ====== -->
<div class="admin-overlay" id="adminOverlay">
  <div class="admin-panel">
    <div class="admin-top">
      <h3>üîí Painel do dono (Estoque / Esgotado)</h3>
      <div class="admin-actions">
        <button class="btn-reset" onclick="resetAdmin()">Restaurar padr√£o</button>
        <button class="btn-close" onclick="closeAdmin()">Fechar</button>
      </div>
    </div>
    <p style="margin-top:0;color:#555;font-size:13px">
      Dica: coloque <b>estoque = 0</b> para esgotar. Se estoque ‚â§ <b>2</b>, aparece ‚Äú√öltimas unidades‚Äù.
    </p>

    <div id="adminList"></div>

    <button class="btn-save" style="width:100%;margin-top:12px" onclick="saveAdmin()">Salvar altera√ß√µes</button>
    <p style="color:#777;font-size:12px;margin-bottom:0">
      Observa√ß√£o: as altera√ß√µes ficam salvas neste aparelho/navegador.
    </p>
  </div>
</div>

<script>
/* =========================
   CONFIGURA√á√ÉO
   ========================= */

// Hor√°rio de funcionamento por dia da semana (0=Dom ... 6=S√°b)
const HORARIOS = {
  0: { abre: "19:00", fecha: "00:00" },
  1: { abre: "19:00", fecha: "00:00" },
  2: { abre: "19:00", fecha: "00:00" },
  3: { abre: "14:00" },
  4: { abre: "19:00", fecha: "00:00" },
  5: { abre: "19:00", fecha: "00:30" },
  6: { abre: "19:00", fecha: "01:00" }
};

const WHATSAPP_NUMERO = "5553999021357";

// Itens do card√°pio (chave -> nome/valor)
const ITEMS = {
  pancho_tradicional: { nome: "Pancho Tradicional", preco: 18 },
  pancho_mega: { nome: "Pancho Mega", preco: 20 },
  pancho_bacon_calabresa: { nome: "Pancho Bacon e Calabresa", preco: 22 },
  pancho_coracao: { nome: "Pancho Cora√ß√£o", preco: 24 },
  coca: { nome: "Coca-Cola", preco: 6 },
  coca_zero: { nome: "Coca-Cola Zero", preco: 6 },
  fruki: { nome: "Fruki", preco: 5 },
  agua: { nome: "√Ågua Mineral", preco: 4 }
};

// Padr√£o de estoque (voc√™ pode mudar aqui tamb√©m)
const DEFAULT_STOCK = {
  pancho_tradicional: 50,
  pancho_mega: 50,
  pancho_bacon_calabresa: 50,
  pancho_coracao: 50,
  coca: 50,
  coca_zero: 50,
  fruki: 50,
  agua: 50
};

// Quando mostrar ‚Äú√öltimas unidades‚Äù
const LIMIAR_ULTIMAS = 2;

// Senha do painel (mude para a sua)
const ADMIN_SENHA = "1234";

/* =========================
   ESTOQUE: localStorage
   ========================= */
const STOCK_KEY = "pancho_stock_v1";

function loadStock() {
  try {
    const saved = localStorage.getItem(STOCK_KEY);
    if (!saved) return { ...DEFAULT_STOCK };
    const obj = JSON.parse(saved);
    return { ...DEFAULT_STOCK, ...obj };
  } catch {
    return { ...DEFAULT_STOCK };
  }
}

function saveStock(obj) {
  localStorage.setItem(STOCK_KEY, JSON.stringify(obj));
}

let stock = loadStock();

/* =========================
   HOR√ÅRIO (aberto/fechado)
   ========================= */
function timeToMinutes(hhmm) {
  const [h, m] = hhmm.split(":").map(Number);
  return (h * 60) + m;
}

function getTodaySchedule() {
  const d = new Date();
  const dow = d.getDay();
  return HORARIOS[dow] || null;
}

function isOpenNow() {
  const schedule = getTodaySchedule();
  if (!schedule) return false;

  const now = new Date();
  const nowMin = now.getHours() * 60 + now.getMinutes();
  const openMin = timeToMinutes(schedule.abre);
  const closeMin = timeToMinutes(schedule.fecha);

  if (closeMin >= openMin) return nowMin >= openMin && nowMin <= closeMin;
  return (nowMin >= openMin) || (nowMin <= closeMin);
}

/* =========================
   UI: tags e bot√µes
   ========================= */
function renderAvailabilityTags(open) {
  Object.keys(ITEMS).forEach(key => {
    const btn = document.getElementById("btn-" + key);
    const tagDiv = document.getElementById("tag-" + key);
    if (!btn || !tagDiv) return;

    const qtd = Number(stock[key] ?? 0);

    // Limpa tags
    tagDiv.innerHTML = "";

    // Regras:
    // - Se fechado: desativa item (mesmo com estoque)
    // - Se estoque = 0: esgotado
    // - Se estoque <= LIMIAR_ULTIMAS: √∫ltimas unidades

    if (!open) {
      btn.disabled = true;
      tagDiv.innerHTML = `<span class="badge closed">Fora do hor√°rio</span>`;
      return;
    }

    if (qtd <= 0) {
      btn.disabled = true;
      tagDiv.innerHTML = `<span class="badge soldout">ESGOTADO</span>`;
      return;
    }

    // Dispon√≠vel
    btn.disabled = false;

    if (qtd <= LIMIAR_ULTIMAS) {
      tagDiv.innerHTML = `<span class="badge low">√öltimas unidades: ${qtd}</span>`;
    } else {
      tagDiv.innerHTML = `<span class="badge ok">Dispon√≠vel</span>`;
    }
  });
}

function updateOpenStatusUI() {
  const badge = document.getElementById("status-badge");
  const notice = document.getElementById("notice");
  const hoursText = document.getElementById("hours-text");

  const schedule = getTodaySchedule();
  hoursText.textContent = schedule
    ? `Hor√°rio de pedidos hoje: ${schedule.abre} √†s ${schedule.fecha}`
    : "Hor√°rio de pedidos: indispon√≠vel";

  const open = isOpenNow();

  document.getElementById("cartBtn").disabled = !open;
  document.getElementById("finalizarBtn").disabled = !open;

  if (open) {
    badge.className = "badge ok";
    badge.textContent = "üü¢ Aberto";
    notice.style.display = "none";
    notice.textContent = "";
  } else {
    badge.className = "badge closed";
    badge.textContent = "üî¥ Fechado";
    notice.style.display = "block";
    notice.innerHTML = "<b>Estamos fechados no momento.</b> Fora do hor√°rio, n√£o √© poss√≠vel adicionar itens nem finalizar pedidos.";
  }

  renderAvailabilityTags(open);
}

/* =========================
   CARRINHO + PEDIDO
   ========================= */
let cart = [];

function addItem(name, price, key) {
  if (!isOpenNow()) { alert("Estamos fora do hor√°rio de pedidos no momento."); return; }
  if ((stock[key] ?? 0) <= 0) { alert("Este item est√° esgotado."); return; }

  let item = cart.find(i => i.name === name);
  if (item) item.qty++;
  else cart.push({ name, price, qty: 1 });

  renderCart();
}

function removeItem(name) {
  let item = cart.find(i => i.name === name);
  if (!item) return;
  item.qty--;
  if (item.qty <= 0) cart = cart.filter(i => i.name !== name);
  renderCart();
}

function renderCart() {
  let items = document.getElementById("cart-items");
  let totalDiv = document.getElementById("total");
  items.innerHTML = "";
  let total = 0;

  cart.forEach(i => {
    total += i.price * i.qty;
    items.innerHTML += `
      <div class="cart-item">
        <span>${i.qty}x ${i.name}</span>
        <div class="cart-controls">
          <button onclick="addItem('${i.name}',${i.price}, null)">+</button>
          <button onclick="removeItem('${i.name}')">‚àí</button>
        </div>
      </div>`;
  });

  if (cart.length === 0) items.innerHTML = "üõí Carrinho vazio";
  totalDiv.innerText = "Total: R$ " + total.toFixed(2);
}

function openCart() {
  if (!isOpenNow()) { alert("Estamos fora do hor√°rio de pedidos no momento."); return; }
  document.getElementById("cart").style.display = "block";
}
function closeCart() { document.getElementById("cart").style.display = "none"; }

function toggleEntrega() {
  const tipo = document.getElementById("tipo").value;
  const box = document.getElementById("entrega-box");
  if (tipo === "Entrega") box.classList.remove("hidden");
  else box.classList.add("hidden");
}

function sendOrder() {
  if (!isOpenNow()) { alert("Estamos fora do hor√°rio de pedidos no momento."); return; }
  if (cart.length === 0) { alert("Adicione itens ao pedido"); return; }

  const nome = document.getElementById("nome").value.trim();
  const horario = document.getElementById("horario").value;
  const tipo = document.getElementById("tipo").value;
  const pagamento = document.getElementById("pagamento").value;
  const endereco = document.getElementById("endereco").value.trim();
  const obs = document.getElementById("obs").value.trim();

  if (!nome) { alert("Informe o nome do destinat√°rio."); return; }
  if (!horario) { alert("Selecione o hor√°rio do pedido."); return; }
  if (!tipo) { alert("Selecione entrega ou retirada."); return; }
  if (!pagamento) { alert("Selecione a forma de pagamento."); return; }
  if (tipo === "Entrega" && !endereco) { alert("Informe o endere√ßo para entrega."); return; }

  let msg = "Ol√°, quero fazer um pedido no Pancho de Bag√©:%0A%0A";
  msg += `Nome: ${encodeURIComponent(nome)}%0A`;
  msg += `Hor√°rio: ${encodeURIComponent(horario)}%0A`;
  msg += `Tipo: ${encodeURIComponent(tipo)}%0A`;
  msg += `Pagamento: ${encodeURIComponent(pagamento)}%0A`;
  if (tipo === "Entrega") msg += `Endere√ßo: ${encodeURIComponent(endereco)}%0A`;
  if (obs) msg += `Observa√ß√µes: ${encodeURIComponent(obs)}%0A`;

  msg += "%0AItens:%0A";
  cart.forEach(i => {
    msg += `${i.qty}x ${encodeURIComponent(i.name)} - R$ ${(i.price * i.qty).toFixed(2)}%0A`;
  });

  const total = cart.reduce((s, i) => s + i.price * i.qty, 0);
  msg += `%0ATotal: R$ ${total.toFixed(2)}`;

  window.open("https://wa.me/" + WHATSAPP_NUMERO + "?text=" + msg, "_blank");
}

/* =========================
   PAINEL ADMIN (escondido)
   - abre tocando 5x no t√≠tulo
   - pede senha
   ========================= */
let tapCount = 0;
let tapTimer = null;

document.getElementById("hdr").addEventListener("click", () => {
  tapCount++;
  clearTimeout(tapTimer);
  tapTimer = setTimeout(() => tapCount = 0, 1200);

  if (tapCount >= 5) {
    tapCount = 0;
    const pass = prompt("Senha do painel:");
    if (pass === null) return;
    if (pass !== ADMIN_SENHA) {
      alert("Senha incorreta.");
      return;
    }
    openAdmin();
  }
});

function openAdmin() {
  buildAdminList();
  document.getElementById("adminOverlay").style.display = "flex";
}
function closeAdmin() {
  document.getElementById("adminOverlay").style.display = "none";
}

function buildAdminList() {
  const el = document.getElementById("adminList");
  el.innerHTML = "";

  Object.keys(ITEMS).forEach(key => {
    const it = ITEMS[key];
    const qtd = Number(stock[key] ?? 0);

    const row = document.createElement("div");
    row.className = "admin-row";

    row.innerHTML = `
      <div>
        <b>${it.nome}</b><br>
        <small>Pre√ßo: R$ ${it.preco.toFixed(2)}</small>
      </div>

      <div>
        <label style="font-size:12px;font-weight:bold">Estoque</label>
        <input type="number" min="0" step="1" id="stk-${key}" value="${qtd}">
      </div>

      <div>
        <label style="font-size:12px;font-weight:bold">Esgotado?</label>
        <select id="sgt-${key}">
          <option value="0"${qtd>0 ? " selected" : ""}>N√£o</option>
          <option value="1"${qtd<=0 ? " selected" : ""}>Sim</option>
        </select>
        <div class="helper">Se ‚ÄúSim‚Äù, estoque vira 0.</div>
      </div>
    `;

    el.appendChild(row);
  });
}

function saveAdmin() {
  Object.keys(ITEMS).forEach(key => {
    const stk = document.getElementById("stk-" + key);
    const sgt = document.getElementById("sgt-" + key);
    if (!stk || !sgt) return;

    let qtd = parseInt(stk.value || "0", 10);
    if (isNaN(qtd) || qtd < 0) qtd = 0;

    if (sgt.value === "1") qtd = 0;
    stock[key] = qtd;
  });

  saveStock(stock);
  updateOpenStatusUI();
  alert("Salvo! ‚úÖ");
  closeAdmin();
}

function resetAdmin() {
  if (!confirm("Restaurar estoque padr√£o?")) return;
  stock = { ...DEFAULT_STOCK };
  saveStock(stock);
  updateOpenStatusUI();
  alert("Padr√£o restaurado ‚úÖ");
  closeAdmin();
}

/* =========================
   Inicializa√ß√£o
   ========================= */
// ===== EXPOE FUN√á√ïES PARA OS BOT√ïES HTML =====
window.openCart = openCart;
window.closeCart = closeCart;

window.add = add;
window.addItem = addItem;
window.addToCart = addToCart;

window.removeItem = removeItem;
window.removeFromCart = removeFromCart;

window.sendOrder = sendOrder;
</script>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

<script>
  // Configura√ß√£o do Firebase (SEU PROJETO)
  const firebaseConfig = {
    apiKey: "AIzaSyBYU_46dL6JAx2ijfmRntDh9mFlqSbsvD4",
    authDomain: "panchodebage.firebaseapp.com",
    projectId: "panchodebage",
    storageBucket: "panchodebage.firebasestorage.app",
    messagingSenderId: "555443410907",
    appId: "1:555443410907:web:76754b4bae7934cd58f9fe"
  };

  // Inicializa Firebase
  firebase.initializeApp(firebaseConfig);

  // Firestore
  const db = firebase.firestore();
</script>
<script>
  // Agora o Firebase j√° existe, ent√£o pode usar
  updateOpenStatusUI();
  setInterval(updateOpenStatusUI, 30000);
</script>
</body>
</html>
